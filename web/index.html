<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>第51回衆院選比例区得票マップ</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="app">
      <div class="top-actions">
        <a
          class="action-button"
          href="https://github.com/mu373/election-202602-shugiin"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="GitHub リポジトリを開く"
          title="GitHub"
        >
          <svg viewBox="0 0 16 16" aria-hidden="true">
            <path
              fill="currentColor"
              d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.5-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.22 2.2.82a7.65 7.65 0 0 1 4 0c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8z"
            />
          </svg>
        </a>
        <button
          id="infoButton"
          class="action-button info-button"
          type="button"
          aria-label="データ・出典情報を表示"
          aria-haspopup="dialog"
          aria-expanded="false"
          title="データ・出典"
        >
          i
        </button>
      </div>
      <div class="left-column">
      <aside class="sidebar">
        <button class="sidebar-close" id="sidebarClose" type="button" aria-label="設定を閉じる">✕ 閉じる</button>
        <h1 id="titleMain"><span class="title-chunk">第51回衆議院議員選挙</span> <span class="title-chunk">比例区得票マップ</span></h1>
        <div class="control-group" id="groupPlotMode">
          <label for="plotModeSelect">表示モード</label>
          <select id="plotModeSelect">
            <option value="share" selected>政党得票率</option>
            <option value="party_rank">選択政党の順位</option>
            <option value="rank">得票率第N位の政党</option>
            <option value="opposition_rank">野党第N党</option>
            <option value="selected_diff">二つの政党の比較</option>
            <option value="ruling_vs_opposition">与野党比較</option>
            <option value="concentration">票の集中度</option>
          </select>
        </div>
        <div id="modeHelp" class="help hidden"></div>
        <div class="control-group" id="groupGranularity">
          <label for="granularitySelect">表示単位</label>
          <select id="granularitySelect">
            <option value="block">ブロック</option>
            <option value="pref">都道府県</option>
            <option value="muni" selected>市区町村</option>
          </select>
        </div>
        <div class="control-group" id="groupParty">
          <label for="partySelect">基準政党</label>
          <select id="partySelect"></select>
        </div>
        <div class="control-group hidden" id="groupCompareTarget">
          <label for="compareTargetSelect">比較対象</label>
          <select id="compareTargetSelect">
            <option value="top" selected>第1党</option>
          </select>
        </div>
        <div class="control-group hidden" id="groupSelectedMetric">
          <label for="selectedMetricSelect">指標</label>
          <select id="selectedMetricSelect">
            <option value="diff" selected>差 (基準 - 比較)</option>
            <option value="ratio">比 (基準/比較)</option>
          </select>
        </div>
        <div id="selectedMetricHelp" class="help hidden"></div>
        <div class="control-group hidden" id="groupRulingMetric">
          <label for="rulingMetricSelect">指標</label>
          <select id="rulingMetricSelect">
            <option value="diff" selected>差 (与党 - 野党)</option>
            <option value="ratio">比 (与党/野党)</option>
          </select>
        </div>
        <div id="rulingMetricHelp" class="help hidden"></div>
        <div class="control-group" id="groupScaleMode">
          <label for="scaleMode">色スケール</label>
          <select id="scaleMode">
            <option value="fixed">固定スケール</option>
            <option value="party">政党別スケール</option>
          </select>
        </div>
        <div id="scaleHelp" class="help">固定: 政党間で同じ基準。</br>政党別: 選択中政党内で濃淡を見やすく調整。</div>
        <div class="control-group" id="groupRank">
          <label for="rankSelect">順位（N）</label>
          <select id="rankSelect"></select>
        </div>

        <div class="block-title display-settings-title">表示設定</div>
        <div class="toggle-group">
          <div class="control-group" id="groupLabels">
            <label class="checkbox-row" for="labelToggle">
              <input id="labelToggle" type="checkbox" />
              地名ラベル表示
            </label>
          </div>
          <div class="control-group" id="groupPrefBorders">
            <label class="checkbox-row" for="prefBorderToggle">
              <input id="prefBorderToggle" type="checkbox" checked />
              都道府県境界を表示
            </label>
          </div>
        </div>

      </aside>
      <div class="legend-panel" id="legendPanel">
        <div class="legend-panel-title"><span class="title-chunk">第51回衆院選</span> <span class="title-chunk">比例区得票マップ</span></div>
        <div class="legend-mode-label" id="legendModeLabel"></div>
        <div class="legend-mode-desc" id="legendModeDesc"></div>
        <div class="block-title" id="legendTitle">凡例（得票率）</div>
        <div id="legend"></div>
        <button class="sidebar-toggle" id="sidebarToggle" type="button" aria-expanded="false" aria-label="設定パネルを開閉">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        </button>
      </div>
      <div class="stats-panel" id="statsPanel">
        <div class="block-title">統計</div>
        <div id="stats" class="stats"></div>
      </div>
      </div>
      <div id="infoModal" class="info-modal" hidden>
        <div
          class="info-modal-panel"
          role="dialog"
          aria-modal="true"
          aria-labelledby="infoTitle"
        >
          <div class="info-modal-header">
            <h2 id="infoTitle">データ・出典情報</h2>
            <button id="infoCloseButton" class="info-close" type="button" aria-label="閉じる">×</button>
          </div>
          <div class="info-modal-content">
            <p>第51回衆議院議員選挙（令和8年2月8日執行）の比例区の得票データを可視化しています。</p>
            <p>比例代表 市区町村別・党派別得票データは、AIエージェントを用いて各都道府県選挙管理委員会サイトから取得・変換しています。</p>
            <h3>主要データ</h3>
            <ul>
              <li><a href="https://github.com/mu373/election-202602-shugiin/blob/main/data/processed/hirei_shikuchouson.csv" target="_blank" rel="noopener noreferrer">比例代表 市区町村別・党派別得票</a></li>
              <li><a href="https://github.com/mu373/election-202602-shugiin/blob/main/web/data/municipalities.geojson" target="_blank" rel="noopener noreferrer">市区町村境界</a>（<a href="https://nlftp.mlit.go.jp/ksj/" target="_blank" rel="noopener noreferrer">国土数値情報 N03 2025</a>）</li>
              <li><a href="https://github.com/mu373/election-202602-shugiin/blob/main/web/data/prefectures.geojson" target="_blank" rel="noopener noreferrer">都道府県境界</a>（<a href="https://nlftp.mlit.go.jp/ksj/" target="_blank" rel="noopener noreferrer">国土数値情報 N03 2025</a>）</li>
              <li><a href="https://github.com/mu373/election-202602-shugiin/blob/main/web/data/blocks.geojson" target="_blank" rel="noopener noreferrer">比例ブロック境界</a>（都道府県境界を集約して作成）</li>
            </ul>
            <h3>ライセンス</h3>
            <ul>
              <li>コード: MIT</li>
              <li>データ: CC0 1.0（特記なき場合）</li>
              <li>加工元データ: 提供元の利用条件に準拠</li>
            </ul>
          </div>
        </div>
      </div>
      <main id="map"></main>
    </div>

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script type="module" src="./app.js"></script>
  </body>
</html>
